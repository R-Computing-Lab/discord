# GitHub Copilot Instructions for discord

## Repository Overview

This repository contains the `discord` R package, which provides
functions for discordant kinship modeling and other sibling-based
quasi-experimental designs. The package enables researchers to analyze
within-family effects while controlling for shared familial confounders.

## Package Purpose

`discord` is designed to: - Facilitate discordant sibling designs in
research - Prepare and structure data for kinship pair analysis -
Perform discordant regression analyses examining within-family effects -
Simulate genetically-informed data for model testing and validation -
Control for shared familial confounding factors in statistical analyses

## Project Structure

This is an R package following standard R package conventions:

- `R/` - Main source code directory containing:
  - `func_discord_data.R` - Data preparation functions
  - `func_discord_regression.R` - Regression analysis functions
  - `func_kinsim.R` - Simulation functions for genetically-informed data
  - `helpers_regression.R` - Helper functions for regression operations
  - `helpers_simulation.R` - Helper functions for simulation operations
  - `data.R` - Data documentation
  - `discord-package.R` - Package-level documentation
- `tests/testthat/` - Test suite using the testthat framework
- `man/` - Documentation files (auto-generated by roxygen2)
- `vignettes/` - Long-form documentation and tutorials
- `data/` - Package data files
- `data-raw/` - Raw data and data processing scripts
- `inst/` - Additional package files

## Development Standards

### Code Style

- **Follow the [Tidyverse Style Guide](https://style.tidyverse.org/)**
  for all R code
- Use roxygen2 comments for function documentation
- Use snake_case for function and variable names
- Keep functions focused and single-purpose
- Include examples in function documentation where appropriate

### Testing

- **Use the `testthat` package** for all tests
- Tests are located in `tests/testthat/`
- All new functionality must include corresponding tests
- Run tests with `devtools::test()` or
  `testthat::test_dir("tests/testthat")`
- Ensure all tests pass before submitting changes

### Documentation

- Use roxygen2 comments (`#'`) for function documentation
- Update `README.Rmd` (not README.md directly) when making user-facing
  changes
- Include `@param`, `@return`, `@examples`, and `@export` tags as
  appropriate
- Document all exported functions
- Use `@importFrom` for specific function imports from other packages

### Dependencies

Key dependencies: - **stats** (Imports) - Core statistical functions -
**testthat** (Suggests) - Testing framework - **dplyr, tidyr,
tidyverse** (Suggests) - Data manipulation - **ggplot2** (Suggests) -
Visualization - **knitr, rmarkdown** (Suggests) - Documentation and
vignettes - **NlsyLinks, BGmisc** (Suggests) - Kinship-related packages

Minimal dependencies are preferred. Only add new dependencies if
absolutely necessary.

## Key Concepts

### Discordant Kinship Modeling

- Analyzes differences within kinship pairs (typically siblings)
- Controls for shared familial factors (genetics, shared environment)
- Separates within-family from between-family effects
- Uses quasi-experimental design principles

### Main Functions

- [`discord_data()`](https://r-computing-lab.github.io/discord/reference/discord_data.md) -
  Prepares data for discordant analysis
- [`discord_regression()`](https://r-computing-lab.github.io/discord/reference/discord_regression.md) -
  Performs within-family regression analysis
- [`kinsim()`](https://r-computing-lab.github.io/discord/reference/kinsim.md) -
  Simulates genetically-informed data for kinship pairs

## Build and Check

This is a CRAN package, so it must pass R CMD check: - Use
`devtools::check()` to run R CMD check - Ensure there are no errors,
warnings, or notes - Use `devtools::build()` to build the package - Use
`devtools::install()` to install locally for testing

## Version Management

- Current version: 1.3 (see DESCRIPTION file)
- Follow semantic versioning
- Update NEWS.md for all user-facing changes
- Version format: MAJOR.MINOR.PATCH

## Contribution Guidelines

See CONTRIBUTING.md for full details: - Fork the repository and create a
feature branch - Commit changes in logical chunks - Ensure all tests
pass - Add tests for new functionality - Update documentation - Follow
the Code of Conduct (CODE_OF_CONDUCT.md)

## Citation and Licensing

- Licensed under GPL-3
- Cite the package using `citation("discord")`
- Maintain author attribution in DESCRIPTION file

## External Resources

- Academic paper:
  <https://www.medrxiv.org/content/10.1101/2025.08.25.25334395v1>
- Package website: <https://r-computing-lab.github.io/discord/>
- GitHub repository: <https://github.com/R-Computing-Lab/discord>
- CRAN page: <https://cran.r-project.org/package=discord>
- Vignettes cover power analysis, regression, categorical predictors,
  plotting, and workflows

## Common Tasks

When working on this repository:

1.  **Adding a new function**:
    - Add to appropriate R/ file
    - Include roxygen2 documentation
    - Export if user-facing (with `@export`)
    - Add tests in tests/testthat/
    - Add examples in documentation
2.  **Modifying existing function**:
    - Update roxygen2 documentation if signature changes
    - Update or add tests for new behavior
    - Check that existing tests still pass
    - Update vignettes if user-facing changes
3.  **Adding dependencies**:
    - Minimize new dependencies
    - Add to DESCRIPTION under Imports or Suggests
    - Use `@importFrom` in roxygen2 comments
    - Prefer Suggests over Imports when possible
4.  **Updating documentation**:
    - Edit README.Rmd (not README.md)
    - Run `devtools::document()` to regenerate .Rd files
    - Run `knitr::knit("README.Rmd")` to regenerate README.md
    - Update NEWS.md for user-facing changes

## Tips for Copilot

- This package deals with kinship data, family structures, and sibling
  comparisons
- Statistical terminology: “discordant” refers to differences within
  pairs
- “Within-family” effects are distinct from “between-family” effects
- Regression models separate these two levels of variation
- The package supports various kinship types (siblings, twins, cousins,
  etc.)
- Data typically comes in pair/dyad format after processing
